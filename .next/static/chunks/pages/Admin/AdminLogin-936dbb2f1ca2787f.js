(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[321],{3454:function(e,n,t){"use strict";var r,i;e.exports=(null==(r=t.g.process)?void 0:r.env)&&"object"==typeof(null==(i=t.g.process)?void 0:i.env)?t.g.process:t(7663)},3226:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Admin/AdminLogin",function(){return t(7322)}])},7322:function(e,n,t){"use strict";t.r(n);var r=t(5893),i=t(7294),s=t(2778),o=t(1163),a=t(7375),u=t(4718),l=t.n(u),c=t(3454);n.default=()=>{let[e,n]=(0,i.useState)(""),[t,u]=(0,i.useState)(""),[d,p]=(0,i.useState)(!1),[f,g]=(0,i.useState)(""),[m,h]=(0,i.useState)(!1),[_,w]=(0,i.useState)(!1),[v,y]=(0,i.useState)(!1),[x,b]=(0,i.useState)(!1),L=(0,o.useRouter)(),A=async()=>{if(!e||!t){g("Please provide both email and password.");return}h(!0),g("");let{data:n,error:r}=await s.O.auth.signInWithPassword({email:e,password:t});if(h(!1),r){g("Invalid login credentials. Please try again.");return}if(!n||!n.user){g("An unexpected error occurred. Please try again.");return}let{data:i,error:o}=await s.O.from("admin").select("role").ilike("email",n.user.email).single();if(o||!i){g("Failed to fetch user role or user not found."),await s.O.auth.signOut();return}if("admin"!==i.role.toLowerCase()){g("Access denied: You are not an admin."),await s.O.auth.signOut();return}b(!0),L.push("/admin")},I=async()=>{if(!e){g("Please enter a valid email address.");return}y(!0);let{error:n}=await s.O.auth.resetPasswordForEmail(e,{redirectTo:c.env.REACT_APP_RESET_PASSWORD_URL||"https://pandeykapil.com.np/reset-password"});y(!1),n?g("Failed to send password reset link. Please try again later."):g("If this email is registered, you will receive a reset link.")};return(0,i.useEffect)(()=>{(async()=>{let{data:e}=await s.O.auth.getSession();e.session&&(b(!0),L.push("/Admin"))})()},[L]),(0,r.jsx)("div",{className:l().loginContainer,children:(0,r.jsxs)("div",{className:l().loginBox,children:[(0,r.jsx)("h1",{className:l().loginTitle,children:_?"Reset Password":"Admin Login"}),f&&(0,r.jsx)("p",{className:l().errorMessage,children:f}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),_?I():A()},children:[(0,r.jsx)("input",{type:"email",value:e,onChange:e=>n(e.target.value),placeholder:"Enter admin email",className:l().inputField}),!_&&(0,r.jsxs)("div",{className:l().passwordInputContainer,children:[(0,r.jsx)("input",{type:d?"text":"password",value:t,onChange:e=>u(e.target.value),placeholder:"Enter password",className:l().inputField}),(0,r.jsx)("button",{type:"button",className:l().togglePassword,onClick:()=>p(!d),children:d?(0,r.jsx)(a.dSq,{}):(0,r.jsx)(a.tgn,{})})]}),(0,r.jsx)("button",{type:"submit",className:l().submitButton,disabled:m,children:m?(0,r.jsx)("span",{className:l().spinner}):"Login"}),(0,r.jsx)("p",{className:l().forgotPasswordLink,onClick:()=>w(!_),children:_?"Back to Login":"Forgot Password?"})]})]})})}},2778:function(e,n,t){"use strict";t.d(n,{O:function(){return o}});var r=t(1372);let i="https://tffwhfvevgjscrhkdmpl.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmZndoZnZldmdqc2NyaGtkbXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjUzMzg4NjcsImV4cCI6MjA0MDkxNDg2N30.VqEkYRZU-s-9QiLp35pHR04wSw3sLVfoswggMCabkeI";if(console.log("Supabase URL: ",i),console.log("Supabase Anon Key: ",s),!i||!s)throw Error("supabaseUrl and supabaseAnonKey are required.");let o=(0,r.eI)(i,s)},4718:function(e){e.exports={loginContainer:"AdminLogin_loginContainer__E02KX",loginBox:"AdminLogin_loginBox__vrlAG",fadeIn:"AdminLogin_fadeIn__zgoEy",float:"AdminLogin_float__Uxugl",loginTitle:"AdminLogin_loginTitle__yqXRm",inputField:"AdminLogin_inputField__czZNp",passwordInputContainer:"AdminLogin_passwordInputContainer__Xa4iY",togglePassword:"AdminLogin_togglePassword__yEXs5",submitButton:"AdminLogin_submitButton__00OxX",forgotPasswordLink:"AdminLogin_forgotPasswordLink__VQdP3",errorMessage:"AdminLogin_errorMessage__BwNe6"}},7663:function(e){!function(){var n={229:function(e){var n,t,r,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{t="function"==typeof clearTimeout?clearTimeout:o}catch(e){t=o}}();var u=[],l=!1,c=-1;function d(){l&&r&&(l=!1,r.length?u=r.concat(u):c=-1,u.length&&p())}function p(){if(!l){var e=a(d);l=!0;for(var n=u.length;n;){for(r=u,u=[];++c<n;)r&&r[c].run();c=-1,n=u.length}r=null,l=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===o||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(n){try{return t.call(null,e)}catch(n){return t.call(this,e)}}}(e)}}function f(e,n){this.fun=e,this.array=n}function g(){}i.nextTick=function(e){var n=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];u.push(new f(e,n)),1!==u.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},t={};function r(e){var i=t[e];if(void 0!==i)return i.exports;var s=t[e]={exports:{}},o=!0;try{n[e](s,s.exports,r),o=!1}finally{o&&delete t[e]}return s.exports}r.ab="//";var i=r(229);e.exports=i}()}},function(e){e.O(0,[372,888,774,179],function(){return e(e.s=3226)}),_N_E=e.O()}]);